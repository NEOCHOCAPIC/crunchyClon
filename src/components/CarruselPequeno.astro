---
import CardAnime from "./CardAnime.astro";
import Animes from "../data/Carrusel.json";
---

<div class="relative w-full max-w-7xl mx-auto" id="carousel-container">
  <h2 class="text-2xl font-bold text-white mb-6 px-4">
    Nuestras recomendaciones
  </h2>

  <div class="relative overflow-hidden" id="carousel-wrapper">
    <div
      class="flex transition-transform duration-500 ease-out"
      id="carousel-track"
    >
      <!-- Las tarjetas se insertarán aquí dinámicamente -->
      {
        Animes.map((anime, index) => (
          <CardAnime
            titulo={anime.titulo}
            imagen={anime.imagen}
            doblaje={anime.doblaje}
            rating={anime.rating}
            votos={anime.votos}
            temporadas={anime.temporadas}
            episodios={anime.episodios}
            descripcion={anime.descripcion}
            class="w-1/5 flex-shrink-0"
          />
        ))
      }
    </div>
  </div>

  <button
    id="prev-button"
    class="absolute left-0 top-1/2 -translate-y-1/2 bg-black/50 p-2 rounded-full text-white hover:bg-black/70 transition-colors z-10"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="m15 18-6-6 6-6"></path>
    </svg>
  </button>

  <button
    id="next-button"
    class="absolute right-0 top-1/2 -translate-y-1/2 bg-black/50 p-2 rounded-full text-white hover:bg-black/70 transition-colors z-10"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="m9 18 6-6-6-6"></path>
    </svg>
  </button>
</div>

<script>
  const carouselTrack = document.getElementById(
    "carousel-track"
  ) as HTMLElement;
  const prevButton = document.getElementById(
    "prev-button"
  ) as HTMLButtonElement;
  const nextButton = document.getElementById(
    "next-button"
  ) as HTMLButtonElement;
  let currentIndex: number = 0;
  const itemsPerPage: number = 5;

  function updateCarouselPosition(): void {
    const totalItems: number = carouselTrack.children.length; // Total de tarjetas
    const totalGroups: number = Math.ceil(totalItems / itemsPerPage); // Grupos totales
    const percentagePerSlide: number = 100 / totalGroups;

    // Log para depuración
    console.log(
      `Total Items: ${totalItems}, Total Groups: ${totalGroups}, Current Index: ${currentIndex}`
    );

    // Actualiza la posición del carrusel
    carouselTrack.style.transform = `translateX(-${currentIndex * percentagePerSlide}%)`;

    // Habilita o desactiva los botones
    prevButton.disabled = currentIndex === 0; // Desactivar botón anterior
    nextButton.disabled = currentIndex >= totalGroups - 1; // Desactivar botón siguiente
  }

  nextButton.addEventListener("click", () => {
    const totalItems: number = carouselTrack.children.length; // Total de tarjetas
    const totalGroups: number = Math.ceil(totalItems / itemsPerPage);
    console.log(
      `Next Button Clicked: Current Index: ${currentIndex}, Total Groups: ${totalGroups}`
    );

    if (currentIndex < totalGroups - 1) {
      currentIndex++;
      updateCarouselPosition();
    }
  });

  prevButton.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      updateCarouselPosition();
    }
  });

  window.addEventListener("resize", updateCarouselPosition);
  updateCarouselPosition(); // Inicializa la posición del carrusel
</script>
